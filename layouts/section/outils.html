{{ define "main" }}
<main class="main">
  <article class="post-single">

    <header class="post-header">
      <h1>{{ .Title }}</h1>
      {{ partial "post-meta.html" . }}
      {{ with .Description }}<p class="outils-desc">{{ . }}</p>{{ end }}
    </header>

    <section class="post-list" id="outils-list">
      {{/* Récupérer l'entrée de menu 'outils', puis lister ses enfants dans l'ordre du menu */}}
      {{ $menu := site.Menus.main }}
      {{ $parents := where $menu "Identifier" "eq" "outils" }}

      {{ if gt (len $parents) 0 }}
        {{ $parent := index $parents 0 }}
        {{ range $parent.Children }}
          {{/* Préfère .Page (si pageRef), sinon on résout via .URL */}}
          {{ $p := .Page }}
          {{ if not $p }}
            {{ $p = site.GetPage .URL }}
          {{ end }}

          {{ with $p }}
            <article class="post-entry">
              <header class="entry-header">
                <h2 class="entry-title">{{ .Title }}</h2>
              </header>
              <div class="entry-content">
                <p>{{ with .Description }}{{ . }}{{ else }}{{ .Summary | plainify }}{{ end }}</p>
              </div>
              <a class="entry-link" aria-label="{{ .Title }}" href="{{ .RelPermalink }}"></a>
            </article>
          {{ end }}
        {{ end }}
      {{ else }}
        {{/* Fallback : lister explicitement les sections connues si l'entrée de menu manque */}}
        {{ range slice
            (site.GetPage "section" "mes-scripts")
            (site.GetPage "section" "recettes")
            (site.GetPage "section" "references") }}
          {{ with . }}
            <article class="post-entry">
              <header class="entry-header">
                <h2 class="entry-title">{{ .Title }}</h2>
              </header>
              <div class="entry-content">
                <p>{{ with .Description }}{{ . }}{{ else }}{{ .Summary | plainify }}{{ end }}</p>
              </div>
              <a class="entry-link" aria-label="{{ .Title }}" href="{{ .RelPermalink }}"></a>
            </article>
          {{ end }}
        {{ end }}
      {{ end }}
    </section>

  </article>
</main>
{{ end }}
