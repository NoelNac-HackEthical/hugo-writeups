{{ define "main" }}
<main id="main" class="home-min">

  {{ $homeTitle := cond (ne .Title "") .Title .Site.Title }}
  {{ $intro := cond (ne .Description "") .Description .Site.Params.description }}

  <section class="home-intro" aria-label="PrÃ©sentation du site">
    {{ with $homeTitle }}<h1 class="home-title">{{ . }}</h1>{{ end }}
    {{ with $intro }}<p>{{ . }}</p>{{ end }}
  </section>

  {{ $main := .Site.Params.mainSections | default (slice "posts") }}
  {{ $pages := where .Site.RegularPages "Section" "in" $main }}
  {{ $ordered := $pages.ByDate.Reverse }}
  {{ $p := .Paginate $ordered }}

  <!-- ðŸ” Filtre machines -->
  <div class="machine-filter-wrap">
    <div class="machine-filter">
      <input id="machineFilter" type="search" placeholder="Recherche machineâ€¦"
        autocomplete="off" inputmode="search" aria-label="Filtrer les machines">
      <div class="machine-filter-meta">
        <span id="machineFilterCount"></span>
      </div>
    </div>
  </div>

  <ul class="post-list js-machine-list">
    {{ range $p.Pages }}
      {{ if eq .Section "writeups" }}
        {{ partial "writeups/summary.html" . }}
      {{ else }}
        {{ .Render "summary" }}
      {{ end }}
    {{ end }}
  </ul>

  <script>
  (function(){
    function n(s){return(s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}
    var i=document.getElementById("machineFilter"),
        c=document.getElementById("machineFilterCount"),
        cards=[].slice.call(document.querySelectorAll(".js-machine-card"));
    if(!i||!cards.length)return;
    function run(){
      var q=n(i.value),k=0;
      cards.forEach(function(li){
        var ok=!q||n(li.dataset.search).includes(q);
        li.style.display=ok?"":"none";
        if(ok)k++;
      });
      c.textContent=k+" / "+cards.length+" machines";
      b.style.display=q?"inline":"none";
    }
    i.addEventListener("input",run);
    run();
  })();
  </script>

</main>
{{ end }}
